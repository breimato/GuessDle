{% extends "base.html" %}
{% load static game_extras %}

{% block title %}{{ game.name }}{% endblock %}

{% block main_class %}
min-h-screen flex flex-col items-center gap-10 py-10 px-4
bg-no-repeat bg-cover bg-fixed
{% endblock %}

{% block content %}

{# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ AUDIO SI ES RETO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
{% if is_challenge %}
  <audio autoplay loop>
    <source src="{{ game.audio_file.url }}" type="audio/mpeg">
  </audio>
  <div class="epic-aura"></div>
{% endif %}

{# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ BOTÃ“N DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
<div class="mb-4">
  <a href="{% url 'dashboard' %}"
     class="bg-yellow-700 hover:bg-yellow-800 text-white font-semibold px-4 py-2 rounded-full shadow transition">
    ğŸ  Dashboard
  </a>
</div>

{# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TÃTULO DEL JUEGO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
<section class="container mx-auto text-center drop-shadow">
  <h1 class="text-5xl md:text-6xl font-bold text-yellow-300 tracking-wide"
      style="font-family:var(--font-lol); text-shadow:2px 2px #000;">
    ğŸ›¡ï¸ {{ game.name }}
  </h1>
</section>

{# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FLAG DE VICTORIA PARA JS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
{% if won %}
  <script id="won-flag" data-champ="{{ target.name|escapejs }}"></script>
{% endif %}

{# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FORMULARIO (desactivado si won) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
<form id="guess-form"
      action="{% url 'ajax_guess' game.slug %}"
      method="post"
      class="bg-amber-100/90 backdrop-blur rounded-3xl p-6 border-4 border-yellow-800 shadow-lg w-full max-w-xl text-gray-900 {% if won %}opacity-50 pointer-events-none{% endif %}"
      novalidate>

  {% csrf_token %}
  <label for="guess" class="block font-semibold mb-2">Â¿QuiÃ©n crees que es?</label>

  {% if guess_error %}
    <p class="text-red-700 font-bold mb-2">Ese personaje no existe o ya fue usado.</p>
  {% endif %}

  <div class="relative">
    <input type="text" name="guess" id="guess" autofocus
           class="w-full p-2 rounded-t border border-yellow-400 bg-white focus:outline-none"
           placeholder="Escribe un nombre"
           autocomplete="off"
           aria-autocomplete="list"
           aria-controls="suggestions"
           aria-expanded="false"
           required
           {% if won %}disabled{% endif %}
           data-names="{{ remaining_names_json|escape }}">
    <ul id="suggestions" role="listbox"
        class="hidden w-full absolute left-0 top-full bg-white text-gray-900 rounded-b-xl
               border-x border-b border-yellow-400 max-h-56 overflow-y-auto z-50"></ul>
  </div>

  <button type="submit"
          class="mt-4 bg-yellow-700 hover:bg-yellow-800 text-white px-4 py-2 rounded-full transition w-full shadow"
          {% if won %}disabled{% endif %}>
    Probar
  </button>
</form>

{# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CABECERA DE ATRIBUTOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
{% if game.attributes %}
  <div id="attempts-header"
       class="grid max-w-3xl mx-auto"
       style="display:none;"
       data-cols="{{ game.attributes|length|add:'1' }}">
    <div class="square square--static font-bold bg-black/70 text-yellow-300 border-yellow-500">ğŸ§ </div>
    {% for attr in game.attributes %}
      <div class="square square--static font-bold bg-black/70 text-yellow-300 border-yellow-500">
        {{ attr|title }}
      </div>
    {% endfor %}
  </div>
{% endif %}

{# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CONTENEDOR DE INTENTOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
<div id="attempts-container"
     class="flex flex-col w-full max-w-3xl mx-auto mt-8"></div>

{# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HISTORIAL JSON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
{% if attempts %}
  {{ attempts|json_script:"initial-attempts" }}
{% endif %}

{# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PERSONAJE DE AYER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
{% if yesterday_target_name %}
  <div class="mt-6 mx-auto max-w-xl bg-black/60 text-white border-2 border-yellow-600 rounded-xl px-4 py-3 shadow-lg backdrop-blur">
    <p class="text-lg text-yellow-200 font-semibold text-center"
       style="font-family: var(--font-lol); text-shadow: 1px 1px #000;">
      ğŸ• El personaje de ayer fue: <span class="text-white">{{ yesterday_target_name }}</span>
    </p>
  </div>
{% endif %}

{% endblock %}

{# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SCRIPTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
{% block extra_scripts %}
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js" defer></script>
  <script src="{% static 'js/guess-autocomplete.js' %}" defer></script>
  <script src="{% static 'js/attempts-live.js' %}" defer></script>
{% endblock %}

<style>
  @import "https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css";

  .square {
    @apply rounded-xl flex items-center justify-center border-2 h-14 md:h-16 font-semibold text-sm text-center;
  }
  .square-good     { @apply bg-green-600 text-white border-green-800; }
  .square-part     { @apply bg-yellow-400 text-black border-yellow-600; }
  .square-bad      { @apply bg-red-700 text-white border-red-800; }
  .square-content  { @apply w-full h-full flex items-center justify-center p-1; }
  .champion-icon-name { @apply text-xs mt-1; }
</style>

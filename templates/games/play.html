{% extends 'base.html' %}
{% load static %}
{% load game_extras %}

{% block title %}{{ game.name }}{% endblock %}

{% block main_class %}
min-h-screen flex flex-col items-center
bg-no-repeat bg-cover bg-fixed
bg-[url('{% static "img/login.png" %}')] py-10 px-4 gap-10
{% endblock %}

{% block content %}
<h1 class="text-3xl font-bold text-yellow-100 mb-6">ðŸŽ® {{ game.name }}</h1>

{% if won %}
<div class="bg-green-200 border-4 border-green-800 p-6 rounded-xl max-w-xl w-full text-center font-serif text-gray-900 shadow-inner">
    <h2 class="text-2xl font-bold mb-4">Â¡Correcto! Has adivinado: <span class="text-green-800">{{ target.name }}</span></h2>
    <a href="{% url 'dashboard' %}" class="inline-block mt-4 bg-green-700 text-white px-6 py-2 rounded hover:bg-green-800 transition">
        Volver al Dashboard
    </a>
</div>
{% else %}
<form method="post" class="bg-amber-100 p-6 rounded-xl shadow-xl border-4 border-yellow-800 w-full max-w-xl text-gray-900">
    {% csrf_token %}
    <label for="guess" class="block font-semibold mb-2">Â¿QuiÃ©n crees que es?</label>

    {% if guess_error %}
    <p class="text-red-700 font-bold mb-2">Ese personaje no existe o ya fue usado.</p>
    {% endif %}

    <input list="guesses" name="guess" id="guess"
           class="w-full p-2 rounded border border-yellow-400 mb-4"
           placeholder="Escribe un nombre" required>

    <datalist id="guesses">
        {% for item in game.items.all %}
            {% if item not in previous_guesses %}
                <option value="{{ item.name }}"></option>
            {% endif %}
        {% endfor %}
    </datalist>

    <button type="submit" class="bg-yellow-700 text-white px-4 py-2 rounded hover:bg-yellow-800 transition w-full">
        Probar
    </button>
</form>
{% endif %}

{% if attempts %}
<table class="gd-table mx-auto">
  <thead>
    <tr>
      <th class="gd-header">CampeÃ³n</th>
      {% for attr in game.attributes %}
        <th class="gd-header">{{ attr|title }}</th>
      {% endfor %}
    </tr>
  </thead>

  <tbody>
    {% for attempt in attempts %}
    <tr>
      <!-- CampeÃ³n -->
      <td class="gd-champ-cell">
        {% if attempt.icon %}
          <img src="{{ attempt.icon }}" alt="{{ attempt.name }}">
        {% endif %}
        <div style="padding:0 .25rem">{{ attempt.name }}</div>
      </td>

      <!-- Atributos -->
      {% for fb in attempt.feedback %}
      <td class="gd-cell {% if fb.correct %}gd-cell--ok
                          {% elif fb.partial %}gd-cell--part
                          {% else %}gd-cell--wrong{% endif %}">
        <div style="position:relative; width:100%; height:100%;">
          <div style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; padding:.25rem;">
            {{ fb.value }}
          </div>
          {% if fb.arrow %}
            <span class="gd-emoji">{{ fb.arrow }}</span>
          {% endif %}
        </div>
      </td>
      {% endfor %}
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endif %}




{% endblock %}
